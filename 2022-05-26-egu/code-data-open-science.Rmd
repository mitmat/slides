---
title: "How to manage code and data for open science (and yourself)"
subtitle: "EGU22 - SC3.13"
author: "Michael Matiu"
institute: ""
date: "2022/05/26"
output:
  xaringan::moon_reader:
    css: [default, css/extra.css]
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
xaringanExtra::use_panelset()

```


### Foreword

.pull-left[
- Slides available at https://mitmat.github.io/slides/

- *Data* = any information in general, focus on digital

- *Code* = anything you do to data, regardless of means (R, python, Excel, ...)



]

--

.pull-right[

- Knowledge of directory structure (see also this [article](https://www.theverge.com/22684730/students-file-folder-directory-structure-education-gen-z) at The Verge)

.center[<a title="Przemub, Public domain, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Ms-dosdir.png"><img width="400" alt="Ms-dosdir" src="https://upload.wikimedia.org/wikipedia/commons/b/b0/Ms-dosdir.png"></a>]

]



<!-- ### Outline -->

<!-- Before you start   -->
<!-- Data   -->
<!-- Code   -->
<!-- Share -->


---


## 0. Before you start your project

If you don't have it: Create folder to store all past and future projects
```{r eval=F}
# wherever you like: Documents, Desktop, home/
/projects/
``` 


--


Create sub-folder for current project
```{r eval=F}
# try not to have a long name
/projects/time-series-analysis-of-winter-precipitation-europe
# better
/projects/winter-prec
``` 

--

Everything in here! **--> Working directory <-- **

(Use IDE capabilities: RStudio, Spyder, PyCharm)

---


### Example structure of working directory

.pull-left[
Basic

```{r eval=F}
data/
R/
fig/
winter-prec.Rproj
```
]

--

.pull-right[
Grow as needed

```{r eval=F}
data/
data-aux/
doc/
fig/
paper/
R/
table/
winter-prec.Rproj
```
]

---


### Why a working directory?

- Organization

- Everything in one place (code, data, output)

--

- Relative file paths allow easy sharing/copying:

```{r eval=F}
# only works on your computer
tbl <- read_csv("C:/Users/michael/Desktop/research/winter.csv")

# works for everybody
tbl <- read_csv("data/winter.csv")
```

- Exception: data hosted on servers (but then paths work for everyone within the institution)


---


### Why a working directory?


- Better for output, too:

```{r eval=F}
# only works on your computer
ggsave("C:/Users/michael/Documents/papers/winter-precipitation/fig01.pdf")

# works for everybody
ggsave("fig/paper/fig01.pdf")
```


---

## 1. Data

What to do with the data you collected, received, downloaded, ... ?

> Store it some place and **NEVER, EVER, EVER, EVER modify it**

--

--> Your first step towards *reproducibility*

--


.pull-left[
**future you**
  - write up methods/documentation
  - have to re-do analysis
]


--


.pull-right[
**others**
  - re-do your analysis
  - do the same with their data
]



---

background-image: url("https://memegenerator.net/img/instances/44834303.jpg")
background-position: center
background-size: contain

---

### Keep track of what you did

.panelset[

.panel[.panel-name[Files]

**manually: ad-hoc versioning with documentation**

```{r eval=F}
/data/samples_meta.docx # documentation
/data/samples_meta_v1.0.xlsx # different versions of your data
/data/samples_meta_v1.1.xlsx
/data/samples_meta_v2.0.xlsx
```

]


.panel[.panel-name[Documentation]

**Content of documentation**

v1.0
- split column coordinates in lat and long
- converted lat/long from dms to decimal

v1.1
- use English for country names instead of local language

v2.0
- updated with 2022 campaign

]


.panel[.panel-name[Alternative]

**use R/python/... for data wrangling**

- scripts = documentation
- minimal/no effort to redo everything

Future you and others will thank you!

]





]








---


## 2. Code

### Data science workflow

.pull-left[



.center[<img src="fig/data-science.png">]

.tiny[Source: R for Data Science, [R4DS](https://r4ds.had.co.nz/)]


... in theory.

]


--


.pull-right[

But usually a bit more messy ...

.center[<img src="fig/data-science-messy.png">]


]



---


### Alternate between...



.pull-left[

**Phase 1: creative**

*interactive* - *volatile* - *changing*

- explore
- visualize
- make errors
- check
- correct



]


.pull-right[

**Phase 2: settle**

*create a linear structure*

- separate what is good and needed vs. rest
- clean
- organize


]


---

Phase 1: free to do what and how you like


---


### Save source, not workspace


More at [What they forgot to teach you about R](https://rstats.wtf/save-source.html)


.pull-left[

**Phase 1: Draft**

- explore
- visualize
- make errors
- check
- correct

*interactive phase*

]


.pull-right[

**Phase 2: Finalize**

- separate what is good and needed vs. rest
- clean


*linear structure*


]

---



### Naming things


+ folders
+ files
+ objects in code


---

### Coding style

notanecessityandyoucandowithout, but code is easier read with

- personal choice
- opinionated



Try to be consistent, as far as possible.

- Tidyverse https://style.tidyverse.org/index.html
- Google https://google.github.io/styleguide/
- PEP https://peps.python.org/pep-0008/
- ...




---

### Commenting (why, not what)


.pull-left[

```{r eval=FALSE}
# divide x by 86400
x <- x/86400


# values above 5000 made NA
y[y > 5000] <- NA

```



]

.pull-right[


```{r eval=FALSE}
# convert per sec to per day
x <- x/86400


# recording errors removed
y[y > 5000] <- NA
```



]


--


<br>

When commenting, think about what


- **future you** might forget
- **others** would not understand



---

## 3. Share


Think about others:

- What would they need to run your code?
- What do they need to understand what you did?

Think about you:
- What did you like about code/data you received or downloaded? 



---

### Do not be afraid to share your code!

.right[What's the worst that can happen?]

--

It's *ignored*.

--

.right[What's more likely?]

--

- helps others, especially early-career scientist or students
- helps you
  - increases confidence
  - others might discover errors
  - more comparisons



---

### Why share data openly?


Legal obligation -> not motivating

Funded by public money -> should be publicly available

--

<br>
So you hesitate, because you...

- feel it's your treasure
- want credit for it (because you deserve it)
- want to exploit it further



---

### But!

Consider this:

- do you have the time/resources to do everything?
- others might think of truly novel/imaginative things to do with your data
- you still remain the authority

--

> If you want to go fast, go alone. 
> If you want to go far, go together.

More success stories from sharing and collaborating.


--

<br>
Inspiring: [uncopyright](https://zenhabits.net/uncopyright/) from [zenhabits](https://zenhabits.net/)


---

### What to consider before sharing?


Questions to yourself:
- do others know how to use it?
- do others understand the limitations?
- can there be misuse? (-> sensitive or personal information)
- are you ok with losing control?


### DIY

put everything on Zenodo.


---

<!-- background-image: url("https://c.tenor.com/3NxIHxOfcGgAAAAC/yard-work-fail.gif") -->
background-image: url("https://c.tenor.com/DprC7x1wvxAAAAAC/bbw-homer-simpson.gif")
background-position: center
background-size: contain


---

### Links

useful reads:

https://stat545.com/ (R course with focus on project organization, data cleaning, ... but NOT statistical inference/modelling)

https://r4ds.had.co.nz/ (R 4 data science)



---


### Contact

Michael Matiu  

`r fontawesome::fa("envelope")` mmatiu.eurac@gmail.com

`r fontawesome::fa("github")` https://github.com/mitmat/

<img src="fig/eu_logo_72x48.png" height="30">  https://clirsnow.netlify.app/

(slides) https://mitmat.github.io/slides/
